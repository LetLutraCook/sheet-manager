<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>sheet manager</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; margin-top: 20px; }
    td, th { border: 1px solid #ccc; padding: 6px 10px; }

    /* Invisible input styling */
    input {
      border: none;
      background: transparent;
      box-shadow: none;
      outline: none;
      width: 100%;
      font: inherit;
      padding: 0;
      margin: 0;
    }

    button { margin-top: 20px; padding: 8px 14px; }
  </style>
</head>

<body onload="loadSheet()">
  <h2>sheet manager</h2>

  <button onclick="loadSheet()">Load Sheet</button>
  <button onclick="saveSheet()">Save Sheet</button>

  <table id="sheet"></table>

  <script>
    const URL = "https://script.google.com/macros/s/AKfycbxlJFQbLvtzRqd1ZYIG2n-d98gKyRPDwt-Vf2vMq11mrPRprnUYL3x72Se2Kqtm6ZTbPQ/exec";

    async function loadSheet() {
      const res = await fetch(URL);
      const data = await res.json();
      renderTable(data);
    }

    function renderTable(data) {
      const table = document.getElementById("sheet");
      table.innerHTML = "";

      data.forEach((row, r) => {
        const tr = document.createElement("tr");

        tr.style.backgroundColor = r % 2 === 0 ? "#ffffff" : "#f2f2f2";

        row.forEach((cell, c) => {
          const td = document.createElement("td");

          const isHeaderRow = r === 0;
          const isHeaderCol = c === 0;
          const isComputedE = c === 4 && r !== 0; // column E except row 1

          if (isHeaderRow || isHeaderCol) {
            td.textContent = cell;
          } else if (isComputedE) {
            const b = Number(row[1]);
            const d = Number(row[3]);
            td.textContent = b - d;
          } else {
            const input = document.createElement("input");
            input.value = cell;
            input.dataset.r = r;
            input.dataset.c = c;
            td.appendChild(input);
          }

          tr.appendChild(td);
        });

        table.appendChild(tr);
      });
    }

    async function saveSheet() {
      const rows = [];
      const table = document.getElementById("sheet");
      const trs = table.querySelectorAll("tr");

      trs.forEach((tr, r) => {
        const tds = tr.querySelectorAll("td");
        rows[r] = [];

        tds.forEach((td, c) => {
          const input = td.querySelector("input");

          if (input) {
            rows[r][c] = input.value;
          } else {
            rows[r][c] = td.textContent;
          }
        });
      });

      await fetch(URL, {
        method: "POST",
        body: JSON.stringify(rows)
      });
    }
  </script>
</body>
</html>
